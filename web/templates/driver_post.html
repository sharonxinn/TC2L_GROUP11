<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="../static/driver_post.css"> -->
    <title>Rider Post</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC2un2GtIOA0jUz-BXUs34Vj-mIfsCiRdk&callback=initMap&libraries=places&v=beta" async defer></script>
    <script>
        let map;
        let marker;

        function initMap() {
            const defaultLocation = { lat: 2.9226, lng: 101.6507 }; // Default location (Example: MMU Cyberjaya)
            
            map = new google.maps.Map(document.getElementById("map"), {
                center: defaultLocation,
                zoom: 15
            });

            marker = new google.maps.Marker({
                position: defaultLocation,
                map: map,
                title: "Pickup Location"
            });

            // Set default hidden fields for pickup location
            document.getElementById("pickup_lat").value = defaultLocation.lat;
            document.getElementById("pickup_lng").value = defaultLocation.lng;
        }

        // Update map and hidden fields based on the selected pickup location
        function updateMapLocation() {
            const locations = {
                "HB1": { lat: 2.9233, lng: 101.6521 },
                "HB2": { lat: 2.9244, lng: 101.6542 },
                "HB3": { lat: 2.9255, lng: 101.6563 },
                "HB4": { lat: 2.9266, lng: 101.6584 },
                "FCI": { lat: 2.9287, lng: 101.6605 },
                "STADIUM": { lat: 2.9298, lng: 101.6626 },
                "DTC": { lat: 2.9319, lng: 101.6647 },
                "Dpulze": { lat: 2.9340, lng: 101.6668 },
                "TamarindSquare": { lat: 2.9361, lng: 101.6689 },
                "MutiaraVille": { lat: 2.9382, lng: 101.6710 },
                "TheArc": { lat: 2.9403, lng: 101.6731 }
            };

            const selectedLocation = document.getElementById("pickup").value;
            const newLocation = locations[selectedLocation];

            if (newLocation) {
                map.setCenter(newLocation);
                marker.setPosition(newLocation);

                // Update hidden fields
                document.getElementById("pickup_lat").value = newLocation.lat;
                document.getElementById("pickup_lng").value = newLocation.lng;
            }
        }
    </script>
</head>

<body>
    <div class="logout">
        <a href="/">
            <input type="image" src="../static/pic&video/logout icon.png" width="50px" height="50px">
        </a>
    </div>

    <div class="outside-center">
        <h1 align="center">Rider Post</h1>
        <div class="middle-box">
            <form action="{{ url_for('main.driver_post') }}" method="post">

                <div class="inner-center">
                    <label for="dateandTime">Date & Time</label>
                    <br>
                    <input type="datetime-local" id="dateandTime" name="dateandTime" required><br>
                </div>

                <div class="left-right">
                    <div class="inner-center">
                        <label for="pickup">Starting Point</label>
                        <br>
                        <select name="pickup" id="pickup" onchange="updateMapLocation()" required>
                            <option value="HB1">HB1</option>
                            <option value="HB2">HB2</option>
                            <option value="HB3">HB3</option>
                            <option value="HB4">HB4</option>
                            <option value="FCI">FCI</option>
                            <option value="STADIUM">STADIUM MMU</option>
                            <option value="DTC">DTC</option>
                            <option value="Dpulze">Dpulze</option>
                            <option value="TamarindSquare">Tamarind Square</option>
                            <option value="MutiaraVille">Mutiara Ville</option>
                            <option value="TheArc">The Arc</option>
                        </select><br>
                        <input type="hidden" id="pickup_lat" name="pickup_lat">
                        <input type="hidden" id="pickup_lng" name="pickup_lng">
                    </div>

                    <div class="inner-center">
                        <label for="dropoff">Drop-Off Point</label>
                        <br>
                        <select name="dropoff" id="dropoff" required>
                            <option value="HB1">HB1</option>
                            <option value="HB2">HB2</option>
                            <option value="HB3">HB3</option>
                            <option value="HB4">HB4</option>
                            <option value="FCI">FCI</option>
                            <option value="MMUSTADIUM">MMU STADIUM</option>
                            <option value="DTC">DTC</option>
                            <option value="Dpulze">Dpulze</option>
                            <option value="TamarindSquare">Tamarind Square</option>
                            <option value="MutiaraVille">Mutiara Ville</option>
                            <option value="TheArc">The Arc</option>
                        </select><br>
                        <input type="hidden" id="dropoff_lat" name="dropoff_lat">
                        <input type="hidden" id="dropoff_lng" name="dropoff_lng">
                    </div>
                </div>

                <div class="left-right">
                    <div class="inner-center">
                        <label for="carplate">Car Plate</label>
                        <br>
                        <input id="carplate" type="text" name="carplate" required placeholder="Enter Car Plate"><br>
                    </div>

                    <div class="inner-center">
                        <label for="carmodel">Car Model</label>
                        <br><input id="carmodel" type="text" name="carmodel" required placeholder="Enter Car Model"><br>
                    </div>
                </div>

                <div class="inner-center">
                    <label for="totalperson">Maximum Number of Passengers</label>
                    <br>
                    <input type="number" id="totalperson" name="totalperson" required>
                </div>

                <script>
                    function feesFunction() {
                        var fees = document.getElementById("fees").value;
                        var duitnowid = document.getElementById("duitnowid");

                        if (fees === "RM1") {
                            duitnowid.style.display = "block";
                        } else {
                            duitnowid.style.display = "none";
                        }
                    }
                </script>

                <div class="inner-center">
                    <label for="fees">Fees</label>
                    <br>
                    <select id="fees" name="fees" onchange="feesFunction()">
                        <option value="Free">Free</option>
                        <option value="RM1">RM1 per person</option>
                    </select><br>
                </div>

                <div class="inner-center" id="duitnowid" style="display: none;">
                    <label for="duitnowid">DuitNow ID</label>
                    <br>
                    <input type="text" name="duitnowid" placeholder="Enter Your DuitNow ID"><br>
                </div>

                <div class="inner-center">
                    <label for="message">Note</label>
                    <textarea id="message" name="message" rows="10" cols="30" placeholder="Enter Note..."></textarea><br><br>
                </div>

                <a href="/base_driver">
                    <input type="submit" value="Submit" class="btn">
                </a>
            </form>

            <!-- Google Map displaying pickup location -->
            <div id="map" style="height: 400px; width: 100%;"></div>

        </div>
    </div>
</body>

</html>
